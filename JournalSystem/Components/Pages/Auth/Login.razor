@using JournalSystem.Components.Layout

@layout AuthLayout
@page "/login"

@inject NavigationManager Nav
@inject IPasswordService PasswordService


<MudContainer Class="d-flex align-center justify-center" Style="min-height:100vh;">
    <MudPaper Class="pa-6 rounded-xl shadow-sm" Style="width:100%; max-width:420px;">

        <EditForm Model="formModel" OnValidSubmit="Unlock">

            <h3>Enter PIN</h3>

            <InputText type="password"
                   placeholder="PIN"
                       @bind-Value="formModel.Pin"
                   style="width:100%; padding:8px; margin-top:12px; border:1px solid #000;" />

            @if (Error != string.Empty)
            {
                <div class="error-message">@Error</div>
            }

            <MudButton Class="mt-4"
                       Variant="Variant.Filled"
                       Color="Color.Primary"
                        ButtonType="ButtonType.Submit"
                       FullWidth="true"
            >
                Unlock
            </MudButton>

        </EditForm>

    </MudPaper>
</MudContainer>

@code {

    public class LoginFormModel
    {
        public string Pin { get; set; } = string.Empty;   
    }
    LoginFormModel formModel = new();

    public String Error { get; set; } = string.Empty;


    async Task Unlock()
    {
        try
        {
            await PasswordService.ValidatePassword(formModel.Pin);
            Nav.NavigateTo("/journal", true);

        }
        catch (Exception e)
        {
			Error = e.Message;
        }

    }
}
