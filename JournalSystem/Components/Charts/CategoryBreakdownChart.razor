@using System.Linq
@using JournalSystem.Models
@inject IJSRuntime JS

<canvas id="breakdown-chart" width="100%" height="400" class="w-full max-h-96"></canvas>

@code {
    [Parameter]
    public List<CategoryBreakdownResult> CategoryBreakdown { get; set; } = new();

    bool chartRendered;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (chartRendered || CategoryBreakdown == null || !CategoryBreakdown.Any())
        {
            return;
        }

        var labels = CategoryBreakdown.Select(c => c.CategoryName).ToArray();
        var data = CategoryBreakdown.Select(c => c.Percentage).ToArray();

        await JS.InvokeVoidAsync("initBarChart", "breakdown-chart", "Category Breakdown", labels, data);
        chartRendered = true;
    }
}